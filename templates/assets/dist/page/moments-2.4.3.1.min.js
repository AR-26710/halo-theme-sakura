import{d as S,s as u}from"../main-2.4.3.1.min.js";import"../assets/_commonjsHelpers-042e6b4d.js";class k{static async like(r,e,t){const n=await fetch("/apis/api.halo.run/v1alpha1/trackers/upvote",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({group:r,plural:e,name:t})});if(n.status!==200){console.error("点赞失败，请求异常");return}return n}}var q=Object.defineProperty,v=Object.getOwnPropertyDescriptor,C=(a,r,e,t)=>{for(var n=t>1?void 0:t?v(r,e):r,o=a.length-1,s;o>=0;o--)(s=a[o])&&(n=(t?s(r,e,n):s(n))||n);return t&&n&&q(r,e,n),n};class E{registerMomentListPagination(){const r=document.getElementById("moment-list-pagination");if(!r)return;const e=r.querySelector("a");e&&e.addEventListener("click",t=>{t.preventDefault();const n=document.querySelector(".moments-container .moments-inner");if(!n)return;const o=t.target,s=o.href;o.classList.add("loading"),o.textContent="",fetch(s,{method:"GET"}).then(i=>i.text()).then(i=>{const l=new DOMParser().parseFromString(i,"text/html"),m=l.querySelector(".moments-container .moments-inner");if(m){this.registerMomentItem(m);const d=m.querySelectorAll(".moments-item");d&&d.length>0&&d.forEach(y=>{n.appendChild(y);const c=y.querySelector(".comment-box .comment script:last-of-type");if(c){const L=c.text||c.textContent||c.innerHTML||"",f=c.parentNode;if(f){f.removeChild(c);const g=document.createElement("script");g.type="text/javascript",g.appendChild(document.createTextNode(L)),f.appendChild(g)}}})}const h=l.querySelector("#moment-list-pagination a");h?o.href=h.href:r.innerHTML="",u.refresh()}).catch(i=>{console.error(i)}).finally(()=>{o.classList.remove("loading"),o.textContent=u.translate("page.moments.loadmore","加载更多..."),u.$localize&&u.$localize(".moments-inner")})})}registerMomentItem(r){const e=r||document.querySelector(".moments-container .moments-inner");if(!e)return;e.querySelectorAll(".moments-item").forEach(o=>{var p,l;const s=o.querySelector(".moment-tools .moment-like"),i=o.querySelector(".moment-tools .comment-js");if(s){const m=s.cloneNode(!0);(p=s.parentNode)==null||p.replaceChild(m,s)}if(i){const m=i.cloneNode(!0);(l=i.parentNode)==null||l.replaceChild(m,i)}});const n=e.querySelectorAll(".moments-item");!n||n.length<=0||n.forEach(o=>{this.registerMomentItemLike(o),this.registerMomentItemComment(o)})}registerMomentItemLike(r){const e=JSON.parse(localStorage.getItem("momentlikedIds")||"[]"),t=r.querySelector(".moment-tools .moment-like");if(!t)return;const n=r.getAttribute("data-name")||"";if(e&&(e!=null&&e.includes(n))){t.classList.add("on");return}t.addEventListener("click",()=>{let o=Number(t.getAttribute("data-links")||"0");k.like("moment.halo.run","moments",n).then(()=>{o+=1,e.push(n),t.classList.add("on"),t.setAttribute("data-links",o.toString());const s=t.querySelector(".moment-like-text");s&&(s.textContent=o.toString()),localStorage.setItem("momentlikedIds",JSON.stringify(e))})},{once:!0})}registerMomentItemComment(r){const e=r.querySelector(".moment-tools .comment-js");e&&e.addEventListener("click",()=>{const t=r.querySelector(".comment-box");t==null||t.classList.toggle("is-show")})}}C([S()],E.prototype,"registerMomentListPagination",1);C([S()],E.prototype,"registerMomentItem",1);
